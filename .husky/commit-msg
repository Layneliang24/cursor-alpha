#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Validate commit message format
echo "ğŸ” Validating commit message format..."

# Check if commitlint is available
if command -v npx >/dev/null 2>&1; then
    npx --no-install commitlint --edit "$1"
else
    echo "âš ï¸  commitlint not found, skipping commit message validation"
fi

# Basic conventional commits validation
commit_regex='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,50}'

if ! grep -qE "$commit_regex" "$1"; then
    echo "âŒ Invalid commit message format!"
    echo "ğŸ“‹ Commit message must follow Conventional Commits format:"
    echo "   <type>[optional scope]: <description>"
    echo ""
    echo "ğŸ“ Examples:"
    echo "   feat: add user authentication"
    echo "   fix(api): resolve login endpoint error"
    echo "   docs: update README with setup instructions"
    echo "   test(frontend): add unit tests for components"
    echo ""
    echo "ğŸ”§ Use 'npm run commit' for interactive commit message creation"
    exit 1
fi

echo "âœ… Commit message format is valid!"