# 界面设计 - 导航设计

## 1. 导航系统概述

### 1.1 设计目标
- **直观性**：用户能够快速找到所需功能
- **一致性**：在不同页面保持统一的导航体验
- **层次性**：清晰的信息架构和导航层级
- **适应性**：支持不同设备和屏幕尺寸
- **扩展性**：支持未来新模块的无缝集成

### 1.2 导航架构
```
导航系统架构
├── 顶部导航栏 (Top Navigation)
│   ├── 品牌标识 (Logo)
│   ├── 主导航菜单 (Main Menu)
│   ├── 用户操作区 (User Actions)
│   └── 系统状态 (System Status)
├── 侧边导航栏 (Side Navigation)
│   ├── 模块导航 (Module Menu)
│   ├── 功能导航 (Feature Menu)
│   └── 快捷操作 (Quick Actions)
├── 面包屑导航 (Breadcrumb)
│   ├── 路径指示 (Path Indicator)
│   └── 快速返回 (Quick Return)
├── 底部导航栏 (Bottom Navigation)
│   ├── 主要功能 (Primary Functions)
│   └── 快速访问 (Quick Access)
└── 上下文菜单 (Context Menu)
    ├── 页面操作 (Page Actions)
    └── 内容操作 (Content Actions)
```

## 2. 顶部导航设计

### 2.1 桌面版顶部导航 (>1200px)
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ [🏠 Alpha]  [博客] [英语学习] [求职管理] [待办笔记] [AI助手] [系统管理]          │
│                                                                                 │
│                                              [🔍] [🔔 3] [👤 用户名 ▼] [⚙️]   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 平板版顶部导航 (768px-1200px)
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ [🏠 Alpha]  [≡ 菜单]                          [🔍] [🔔 3] [👤 ▼] [⚙️]         │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 手机版顶部导航 (<768px)
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ [≡]  Alpha 个人管理平台                                    [🔔] [👤]           │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 顶部导航组件设计

#### 2.4.1 品牌标识区域
```vue
<template>
  <div class="brand-section">
    <router-link to="/" class="brand-link">
      <img src="/logo.svg" alt="Alpha" class="brand-logo" />
      <span class="brand-text">Alpha</span>
    </router-link>
  </div>
</template>

<style scoped>
.brand-section {
  display: flex;
  align-items: center;
  padding: 0 20px;
}

.brand-link {
  display: flex;
  align-items: center;
  text-decoration: none;
  color: var(--primary-color);
  font-size: 24px;
  font-weight: bold;
}

.brand-logo {
  width: 32px;
  height: 32px;
  margin-right: 8px;
}

.brand-text {
  display: inline;
}

@media (max-width: 768px) {
  .brand-text {
    display: none;
  }
}
</style>
```

#### 2.4.2 主导航菜单
```vue
<template>
  <nav class="main-navigation">
    <ul class="nav-list">
      <li 
        v-for="module in availableModules" 
        :key="module.name"
        class="nav-item"
        :class="{ active: currentModule === module.name }"
      >
        <router-link 
          :to="module.path" 
          class="nav-link"
          @click="setCurrentModule(module.name)"
        >
          <i :class="module.icon"></i>
          <span class="nav-text">{{ module.label }}</span>
        </router-link>
      </li>
    </ul>
  </nav>
</template>

<script>
import { ref, computed } from 'vue'
import { useRoute } from 'vue-router'
import { useUserStore } from '@/stores/user'

export default {
  name: 'MainNavigation',
  setup() {
    const route = useRoute()
    const userStore = useUserStore()
    const currentModule = ref('')
    
    // 所有可用模块
    const allModules = [
      {
        name: 'blog',
        label: '博客',
        icon: 'icon-blog',
        path: '/blog',
        permission: 'blog.access'
      },
      {
        name: 'english',
        label: '英语学习',
        icon: 'icon-english',
        path: '/english',
        permission: 'english.access'
      },
      {
        name: 'job',
        label: '求职管理',
        icon: 'icon-job',
        path: '/job',
        permission: 'job.access'
      },
      {
        name: 'todo',
        label: '待办笔记',
        icon: 'icon-todo',
        path: '/todo',
        permission: 'todo.access'
      },
      {
        name: 'ai',
        label: 'AI助手',
        icon: 'icon-ai',
        path: '/ai',
        permission: 'ai.access'
      },
      {
        name: 'system',
        label: '系统管理',
        icon: 'icon-system',
        path: '/system',
        permission: 'system.access'
      }
    ]
    
    // 根据权限过滤可用模块
    const availableModules = computed(() => {
      return allModules.filter(module => 
        userStore.hasPermission(module.permission)
      )
    })
    
    const setCurrentModule = (moduleName) => {
      currentModule.value = moduleName
    }
    
    // 监听路由变化，更新当前模块
    watch(() => route.path, (newPath) => {
      const module = allModules.find(m => newPath.startsWith(m.path))
      if (module) {
        currentModule.value = module.name
      }
    }, { immediate: true })
    
    return {
      availableModules,
      currentModule,
      setCurrentModule
    }
  }
}
</script>

<style scoped>
.main-navigation {
  flex: 1;
  display: flex;
  justify-content: center;
}

.nav-list {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 8px;
}

.nav-item {
  position: relative;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  text-decoration: none;
  color: var(--text-color-secondary);
  border-radius: 8px;
  transition: all 0.3s ease;
  font-size: 14px;
  font-weight: 500;
}

.nav-link:hover {
  color: var(--primary-color);
  background-color: var(--primary-color-light);
}

.nav-item.active .nav-link {
  color: var(--primary-color);
  background-color: var(--primary-color-light);
}

.nav-link i {
  margin-right: 6px;
  font-size: 16px;
}

.nav-text {
  white-space: nowrap;
}

@media (max-width: 1200px) {
  .nav-text {
    display: none;
  }
  
  .nav-link {
    padding: 12px;
  }
  
  .nav-link i {
    margin-right: 0;
  }
}

@media (max-width: 768px) {
  .main-navigation {
    display: none;
  }
}
</style>
```

#### 2.4.3 用户操作区域
```vue
<template>
  <div class="user-actions">
    <!-- 搜索按钮 -->
    <el-tooltip content="全局搜索" placement="bottom">
      <el-button 
        circle 
        size="small" 
        @click="showGlobalSearch = true"
        class="action-btn"
      >
        <i class="icon-search"></i>
      </el-button>
    </el-tooltip>
    
    <!-- 通知按钮 -->
    <el-badge :value="notificationCount" :hidden="notificationCount === 0">
      <el-tooltip content="通知" placement="bottom">
        <el-button 
          circle 
          size="small" 
          @click="showNotifications = true"
          class="action-btn"
        >
          <i class="icon-notification"></i>
        </el-button>
      </el-tooltip>
    </el-badge>
    
    <!-- 用户菜单 -->
    <el-dropdown @command="handleUserMenuCommand">
      <div class="user-menu-trigger">
        <el-avatar 
          :size="32" 
          :src="userInfo.avatar" 
          :icon="UserFilled"
        />
        <span class="username">{{ userInfo.username }}</span>
        <i class="icon-arrow-down"></i>
      </div>
      
      <template #dropdown>
        <el-dropdown-menu>
          <el-dropdown-item command="profile">
            <i class="icon-user"></i>
            个人资料
          </el-dropdown-item>
          <el-dropdown-item command="settings">
            <i class="icon-settings"></i>
            账户设置
          </el-dropdown-item>
          <el-dropdown-item command="preferences">
            <i class="icon-preferences"></i>
            偏好设置
          </el-dropdown-item>
          <el-dropdown-item divided command="logout">
            <i class="icon-logout"></i>
            退出登录
          </el-dropdown-item>
        </el-dropdown-menu>
      </template>
    </el-dropdown>
    
    <!-- 系统设置按钮 -->
    <el-tooltip content="系统设置" placement="bottom" v-if="hasSystemAccess">
      <el-button 
        circle 
        size="small" 
        @click="$router.push('/system')"
        class="action-btn"
      >
        <i class="icon-system-settings"></i>
      </el-button>
    </el-tooltip>
  </div>
</template>

<script>
import { ref, computed } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { UserFilled } from '@element-plus/icons-vue'
import { useUserStore } from '@/stores/user'
import { useNotificationStore } from '@/stores/notification'

export default {
  name: 'UserActions',
  setup() {
    const router = useRouter()
    const userStore = useUserStore()
    const notificationStore = useNotificationStore()
    
    const showGlobalSearch = ref(false)
    const showNotifications = ref(false)
    
    const userInfo = computed(() => userStore.userInfo)
    const notificationCount = computed(() => notificationStore.unreadCount)
    const hasSystemAccess = computed(() => userStore.hasPermission('system.access'))
    
    const handleUserMenuCommand = (command) => {
      switch (command) {
        case 'profile':
          router.push('/profile')
          break
        case 'settings':
          router.push('/settings')
          break
        case 'preferences':
          router.push('/preferences')
          break
        case 'logout':
          handleLogout()
          break
      }
    }
    
    const handleLogout = async () => {
      try {
        await userStore.logout()
        ElMessage.success('已安全退出')
        router.push('/login')
      } catch (error) {
        ElMessage.error('退出失败')
      }
    }
    
    return {
      showGlobalSearch,
      showNotifications,
      userInfo,
      notificationCount,
      hasSystemAccess,
      UserFilled,
      handleUserMenuCommand
    }
  }
}
</script>

<style scoped>
.user-actions {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 20px;
}

.action-btn {
  border: none;
  background: transparent;
  color: var(--text-color-secondary);
}

.action-btn:hover {
  color: var(--primary-color);
  background-color: var(--primary-color-light);
}

.user-menu-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 8px;
  border-radius: 20px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.user-menu-trigger:hover {
  background-color: var(--hover-background);
}

.username {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-color-primary);
}

.icon-arrow-down {
  font-size: 12px;
  color: var(--text-color-secondary);
  transition: transform 0.3s ease;
}

@media (max-width: 768px) {
  .username {
    display: none;
  }
  
  .icon-arrow-down {
    display: none;
  }
  
  .user-actions {
    gap: 8px;
    padding: 0 12px;
  }
}
</style>
```

## 3. 侧边导航设计

### 3.1 侧边导航布局
```vue
<template>
  <aside class="sidebar" :class="{ collapsed: isCollapsed }">
    <!-- 侧边栏头部 -->
    <div class="sidebar-header">
      <div class="module-info">
        <i :class="currentModule.icon" class="module-icon"></i>
        <div class="module-details" v-if="!isCollapsed">
          <h3 class="module-name">{{ currentModule.name }}</h3>
          <p class="module-desc">{{ currentModule.description }}</p>
        </div>
      </div>
      <el-button 
        circle 
        size="small" 
        @click="toggleSidebar"
        class="toggle-btn"
      >
        <i :class="isCollapsed ? 'icon-expand' : 'icon-collapse'"></i>
      </el-button>
    </div>
    
    <!-- 功能导航菜单 -->
    <nav class="sidebar-nav">
      <el-menu
        :default-active="activeMenu"
        :collapse="isCollapsed"
        :unique-opened="true"
        class="sidebar-menu"
        @select="handleMenuSelect"
      >
        <template v-for="item in menuItems" :key="item.path">
          <!-- 单级菜单 -->
          <el-menu-item 
            v-if="!item.children" 
            :index="item.path"
            :disabled="!hasPermission(item.permission)"
          >
            <i :class="item.icon"></i>
            <template #title>{{ item.title }}</template>
          </el-menu-item>
          
          <!-- 多级菜单 -->
          <el-sub-menu 
            v-else 
            :index="item.path"
            :disabled="!hasPermission(item.permission)"
          >
            <template #title>
              <i :class="item.icon"></i>
              <span>{{ item.title }}</span>
            </template>
            
            <el-menu-item 
              v-for="child in item.children"
              :key="child.path"
              :index="child.path"
              :disabled="!hasPermission(child.permission)"
            >
              <i :class="child.icon"></i>
              <template #title>{{ child.title }}</template>
            </el-menu-item>
          </el-sub-menu>
        </template>
      </el-menu>
    </nav>
    
    <!-- 快捷操作区域 -->
    <div class="sidebar-actions" v-if="!isCollapsed">
      <el-button 
        v-for="action in quickActions" 
        :key="action.key"
        :type="action.type"
        size="small"
        @click="handleQuickAction(action)"
        class="quick-action-btn"
      >
        <i :class="action.icon"></i>
        {{ action.label }}
      </el-button>
    </div>
  </aside>
</template>

<script>
import { ref, computed, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useUserStore } from '@/stores/user'

export default {
  name: 'Sidebar',
  setup() {
    const route = useRoute()
    const router = useRouter()
    const userStore = useUserStore()
    
    const isCollapsed = ref(false)
    const activeMenu = ref('')
    
    // 当前模块信息
    const currentModule = computed(() => {
      const path = route.path
      if (path.startsWith('/blog')) {
        return {
          name: '博客管理',
          description: '文章创作与内容管理',
          icon: 'icon-blog'
        }
      } else if (path.startsWith('/english')) {
        return {
          name: '英语学习',
          description: '词汇、表达与发音练习',
          icon: 'icon-english'
        }
      } else if (path.startsWith('/job')) {
        return {
          name: '求职管理',
          description: '简历制作与求职跟踪',
          icon: 'icon-job'
        }
      } else if (path.startsWith('/todo')) {
        return {
          name: '待办笔记',
          description: '任务管理与学习笔记',
          icon: 'icon-todo'
        }
      } else if (path.startsWith('/ai')) {
        return {
          name: 'AI助手',
          description: '智能对话与知识问答',
          icon: 'icon-ai'
        }
      } else if (path.startsWith('/system')) {
        return {
          name: '系统管理',
          description: '用户权限与系统设置',
          icon: 'icon-system'
        }
      }
      return {
        name: 'Alpha平台',
        description: '个人学习与工作管理',
        icon: 'icon-home'
      }
    })
    
    // 菜单项配置
    const menuItems = computed(() => {
      const path = route.path
      
      if (path.startsWith('/blog')) {
        return [
          {
            path: '/blog/dashboard',
            title: '仪表盘',
            icon: 'icon-dashboard',
            permission: 'blog.access'
          },
          {
            path: '/blog/articles',
            title: '文章管理',
            icon: 'icon-article',
            permission: 'blog.article.view',
            children: [
              {
                path: '/blog/articles/list',
                title: '文章列表',
                icon: 'icon-list',
                permission: 'blog.article.view'
              },
              {
                path: '/blog/articles/create',
                title: '创建文章',
                icon: 'icon-create',
                permission: 'blog.article.create'
              },
              {
                path: '/blog/articles/drafts',
                title: '草稿箱',
                icon: 'icon-draft',
                permission: 'blog.article.view'
              }
            ]
          },
          {
            path: '/blog/categories',
            title: '分类管理',
            icon: 'icon-category',
            permission: 'blog.category.manage'
          },
          {
            path: '/blog/tags',
            title: '标签管理',
            icon: 'icon-tag',
            permission: 'blog.tag.manage'
          },
          {
            path: '/blog/crawler',
            title: '爬虫管理',
            icon: 'icon-crawler',
            permission: 'blog.crawler.manage'
          },
          {
            path: '/blog/analytics',
            title: '数据分析',
            icon: 'icon-analytics',
            permission: 'blog.analytics.view'
          }
        ]
      } else if (path.startsWith('/english')) {
        return [
          {
            path: '/english/dashboard',
            title: '学习概览',
            icon: 'icon-dashboard',
            permission: 'english.access'
          },
          {
            path: '/english/vocabulary',
            title: '词汇学习',
            icon: 'icon-vocabulary',
            permission: 'english.word.manage',
            children: [
              {
                path: '/english/vocabulary/words',
                title: '单词本',
                icon: 'icon-book',
                permission: 'english.word.manage'
              },
              {
                path: '/english/vocabulary/practice',
                title: '单词练习',
                icon: 'icon-practice',
                permission: 'english.word.manage'
              },
              {
                path: '/english/vocabulary/review',
                title: '复习计划',
                icon: 'icon-review',
                permission: 'english.word.manage'
              }
            ]
          },
          {
            path: '/english/expressions',
            title: '地道表达',
            icon: 'icon-expression',
            permission: 'english.expression.manage'
          },
          {
            path: '/english/news',
            title: '英文新闻',
            icon: 'icon-news',
            permission: 'english.news.manage'
          },
          {
            path: '/english/pronunciation',
            title: '发音练习',
            icon: 'icon-pronunciation',
            permission: 'english.pronunciation.manage'
          },
          {
            path: '/english/progress',
            title: '学习进度',
            icon: 'icon-progress',
            permission: 'english.progress.view'
          }
        ]
      }
      // ... 其他模块的菜单配置
      
      return []
    })
    
    // 快捷操作
    const quickActions = computed(() => {
      const path = route.path
      
      if (path.startsWith('/blog')) {
        return [
          {
            key: 'new-article',
            label: '写文章',
            icon: 'icon-edit',
            type: 'primary',
            action: () => router.push('/blog/articles/create')
          },
          {
            key: 'import',
            label: '导入',
            icon: 'icon-import',
            type: 'default',
            action: () => console.log('导入文章')
          }
        ]
      } else if (path.startsWith('/english')) {
        return [
          {
            key: 'add-word',
            label: '添加单词',
            icon: 'icon-plus',
            type: 'primary',
            action: () => console.log('添加单词')
          },
          {
            key: 'start-practice',
            label: '开始练习',
            icon: 'icon-play',
            type: 'success',
            action: () => router.push('/english/vocabulary/practice')
          }
        ]
      }
      
      return []
    })
    
    const hasPermission = (permission) => {
      return userStore.hasPermission(permission)
    }
    
    const toggleSidebar = () => {
      isCollapsed.value = !isCollapsed.value
    }
    
    const handleMenuSelect = (index) => {
      router.push(index)
    }
    
    const handleQuickAction = (action) => {
      action.action()
    }
    
    // 监听路由变化，更新活动菜单
    watch(() => route.path, (newPath) => {
      activeMenu.value = newPath
    }, { immediate: true })
    
    return {
      isCollapsed,
      activeMenu,
      currentModule,
      menuItems,
      quickActions,
      hasPermission,
      toggleSidebar,
      handleMenuSelect,
      handleQuickAction
    }
  }
}
</script>

<style scoped>
.sidebar {
  width: 280px;
  background: var(--sidebar-background);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: width 0.3s ease;
  height: 100vh;
  overflow: hidden;
}

.sidebar.collapsed {
  width: 64px;
}

.sidebar-header {
  padding: 20px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.module-info {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  min-width: 0;
}

.module-icon {
  font-size: 24px;
  color: var(--primary-color);
  flex-shrink: 0;
}

.module-details {
  min-width: 0;
}

.module-name {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 4px 0;
  color: var(--text-color-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.module-desc {
  font-size: 12px;
  color: var(--text-color-secondary);
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.toggle-btn {
  flex-shrink: 0;
  border: none;
  background: transparent;
  color: var(--text-color-secondary);
}

.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  padding: 8px 0;
}

.sidebar-menu {
  border: none;
  background: transparent;
}

.sidebar-actions {
  padding: 16px;
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.quick-action-btn {
  width: 100%;
  justify-content: flex-start;
}

.quick-action-btn i {
  margin-right: 8px;
}

@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: -280px;
    z-index: 1000;
    transition: left 0.3s ease;
  }
  
  .sidebar.open {
    left: 0;
  }
}
</style>
```

## 4. 面包屑导航设计

### 4.1 面包屑组件
```vue
<template>
  <nav class="breadcrumb-nav" v-if="breadcrumbs.length > 1">
    <ol class="breadcrumb-list">
      <li 
        v-for="(item, index) in breadcrumbs" 
        :key="item.path"
        class="breadcrumb-item"
        :class="{ active: index === breadcrumbs.length - 1 }"
      >
        <router-link 
          v-if="index < breadcrumbs.length - 1"
          :to="item.path"
          class="breadcrumb-link"
        >
          <i :class="item.icon" v-if="item.icon"></i>
          {{ item.title }}
        </router-link>
        <span v-else class="breadcrumb-current">
          <i :class="item.icon" v-if="item.icon"></i>
          {{ item.title }}
        </span>
        
        <i 
          v-if="index < breadcrumbs.length - 1"
          class="breadcrumb-separator icon-arrow-right"
        ></i>
      </li>
    </ol>
  </nav>
</template>

<script>
import { computed } from 'vue'
import { useRoute } from 'vue-router'

export default {
  name: 'Breadcrumb',
  setup() {
    const route = useRoute()
    
    const breadcrumbs = computed(() => {
      const matched = route.matched.filter(item => item.meta && item.meta.title)
      const breadcrumbList = []
      
      // 添加首页
      breadcrumbList.push({
        title: '首页',
        path: '/',
        icon: 'icon-home'
      })
      
      // 添加匹配的路由
      matched.forEach(item => {
        if (item.path !== '/') {
          breadcrumbList.push({
            title: item.meta.title,
            path: item.path,
            icon: item.meta.icon
          })
        }
      })
      
      return breadcrumbList
    })
    
    return {
      breadcrumbs
    }
  }
}
</script>

<style scoped>
.breadcrumb-nav {
  padding: 12px 24px;
  background: var(--background-color);
  border-bottom: 1px solid var(--border-color);
}

.breadcrumb-list {
  display: flex;
  align-items: center;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 8px;
}

.breadcrumb-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.breadcrumb-link {
  display: flex;
  align-items: center;
  gap: 4px;
  text-decoration: none;
  color: var(--text-color-secondary);
  font-size: 14px;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.breadcrumb-link:hover {
  color: var(--primary-color);
  background-color: var(--primary-color-light);
}

.breadcrumb-current {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--text-color-primary);
  font-size: 14px;
  font-weight: 500;
}

.breadcrumb-separator {
  color: var(--text-color-disabled);
  font-size: 12px;
}

@media (max-width: 768px) {
  .breadcrumb-nav {
    padding: 8px 16px;
  }
  
  .breadcrumb-item:not(:last-child):not(:first-child) {
    display: none;
  }
}
</style>
```

## 5. 底部导航设计 (移动端)

### 5.1 移动端底部导航
```vue
<template>
  <nav class="bottom-navigation" v-if="isMobile">
    <div 
      v-for="item in bottomNavItems" 
      :key="item.name"
      class="bottom-nav-item"
      :class="{ active: currentModule === item.name }"
      @click="navigateTo(item)"
    >
      <i :class="item.icon" class="nav-icon"></i>
      <span class="nav-label">{{ item.label }}</span>
      <div class="nav-badge" v-if="item.badge">{{ item.badge }}</div>
    </div>
  </nav>
</template>

<script>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useUserStore } from '@/stores/user'

export default {
  name: 'BottomNavigation',
  setup() {
    const route = useRoute()
    const router = useRouter()
    const userStore = useUserStore()
    
    const isMobile = ref(false)
    const currentModule = ref('')
    
    const bottomNavItems = computed(() => {
      const items = [
        {
          name: 'blog',
          label: '博客',
          icon: 'icon-blog',
          path: '/blog',
          permission: 'blog.access'
        },
        {
          name: 'english',
          label: '学习',
          icon: 'icon-english',
          path: '/english',
          permission: 'english.access'
        },
        {
          name: 'todo',
          label: '待办',
          icon: 'icon-todo',
          path: '/todo',
          permission: 'todo.access',
          badge: 3 // 示例：待办数量
        },
        {
          name: 'ai',
          label: 'AI',
          icon: 'icon-ai',
          path: '/ai',
          permission: 'ai.access'
        },
        {
          name: 'more',
          label: '更多',
          icon: 'icon-more',
          path: '/more'
        }
      ]
      
      return items.filter(item => 
        !item.permission || userStore.hasPermission(item.permission)
      )
    })
    
    const checkMobile = () => {
      isMobile.value = window.innerWidth <= 768
    }
    
    const navigateTo = (item) => {
      if (item.name === 'more') {
        // 显示更多菜单
        showMoreMenu()
      } else {
        router.push(item.path)
      }
    }
    
    const showMoreMenu = () => {
      // 实现更多菜单逻辑
      console.log('显示更多菜单')
    }
    
    // 监听路由变化
    watch(() => route.path, (newPath) => {
      const item = bottomNavItems.value.find(item => 
        newPath.startsWith(item.path)
      )
      if (item) {
        currentModule.value = item.name
      }
    }, { immediate: true })
    
    onMounted(() => {
      checkMobile()
      window.addEventListener('resize', checkMobile)
    })
    
    onUnmounted(() => {
      window.removeEventListener('resize', checkMobile)
    })
    
    return {
      isMobile,
      currentModule,
      bottomNavItems,
      navigateTo
    }
  }
}
</script>

<style scoped>
.bottom-navigation {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--background-color);
  border-top: 1px solid var(--border-color);
  display: flex;
  z-index: 1000;
  padding: 8px 0;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
}

.bottom-nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 4px;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
}

.bottom-nav-item:active {
  transform: scale(0.95);
}

.nav-icon {
  font-size: 20px;
  color: var(--text-color-secondary);
  margin-bottom: 4px;
  transition: color 0.3s ease;
}

.nav-label {
  font-size: 10px;
  color: var(--text-color-secondary);
  transition: color 0.3s ease;
}

.bottom-nav-item.active .nav-icon,
.bottom-nav-item.active .nav-label {
  color: var(--primary-color);
}

.nav-badge {
  position: absolute;
  top: 4px;
  right: 20%;
  background: var(--error-color);
  color: white;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 16px;
  text-align: center;
  line-height: 1.2;
}
</style>
```

## 6. 导航状态管理

### 6.1 导航状态Store
```javascript
// stores/navigation.js
import { defineStore } from 'pinia'

export const useNavigationStore = defineStore('navigation', {
  state: () => ({
    // 侧边栏状态
    sidebarCollapsed: false,
    sidebarVisible: true,
    
    // 当前导航状态
    currentModule: '',
    currentPage: '',
    
    // 面包屑导航
    breadcrumbs: [],
    
    // 移动端导航
    mobileMenuVisible: false,
    
    // 导航历史
    navigationHistory: [],
    
    // 快捷导航
    pinnedPages: []
  }),
  
  getters: {
    // 获取当前模块信息
    getCurrentModuleInfo: (state) => {
      const modules = {
        blog: { name: '博客', icon: 'icon-blog', color: '#1890ff' },
        english: { name: '英语学习', icon: 'icon-english', color: '#52c41a' },
        job: { name: '求职管理', icon: 'icon-job', color: '#fa8c16' },
        todo: { name: '待办笔记', icon: 'icon-todo', color: '#722ed1' },
        ai: { name: 'AI助手', icon: 'icon-ai', color: '#eb2f96' },
        system: { name: '系统管理', icon: 'icon-system', color: '#f5222d' }
      }
      return modules[state.currentModule] || modules.blog
    },
    
    // 获取导航历史（最近访问）
    getRecentPages: (state) => {
      return state.navigationHistory.slice(-10).reverse()
    },
    
    // 获取固定页面
    getPinnedPages: (state) => {
      return state.pinnedPages
    }
  },
  
  actions: {
    // 切换侧边栏
    toggleSidebar() {
      this.sidebarCollapsed = !this.sidebarCollapsed
    },
    
    // 设置侧边栏可见性
    setSidebarVisible(visible) {
      this.sidebarVisible = visible
    },
    
    // 设置当前模块
    setCurrentModule(module) {
      this.currentModule = module
    },
    
    // 设置当前页面
    setCurrentPage(page) {
      this.currentPage = page
      this.addToHistory(page)
    },
    
    // 设置面包屑
    setBreadcrumbs(breadcrumbs) {
      this.breadcrumbs = breadcrumbs
    },
    
    // 切换移动端菜单
    toggleMobileMenu() {
      this.mobileMenuVisible = !this.mobileMenuVisible
    },
    
    // 添加到导航历史
    addToHistory(page) {
      const existingIndex = this.navigationHistory.findIndex(
        item => item.path === page.path
      )
      
      if (existingIndex > -1) {
        // 如果已存在，移除旧的
        this.navigationHistory.splice(existingIndex, 1)
      }
      
      // 添加到末尾
      this.navigationHistory.push({
        ...page,
        timestamp: Date.now()
      })
      
      // 限制历史记录数量
      if (this.navigationHistory.length > 50) {
        this.navigationHistory = this.navigationHistory.slice(-50)
      }
    },
    
    // 固定页面
    pinPage(page) {
      const exists = this.pinnedPages.find(item => item.path === page.path)
      if (!exists) {
        this.pinnedPages.push(page)
      }
    },
    
    // 取消固定页面
    unpinPage(path) {
      const index = this.pinnedPages.findIndex(item => item.path === path)
      if (index > -1) {
        this.pinnedPages.splice(index, 1)
      }
    },
    
    // 清空导航历史
    clearHistory() {
      this.navigationHistory = []
    },
    
    // 初始化导航状态
    initNavigation() {
      // 从localStorage恢复状态
      const saved = localStorage.getItem('navigation-state')
      if (saved) {
        try {
          const state = JSON.parse(saved)
          this.sidebarCollapsed = state.sidebarCollapsed || false
          this.pinnedPages = state.pinnedPages || []
        } catch (error) {
          console.error('Failed to restore navigation state:', error)
        }
      }
    },
    
    // 保存导航状态
    saveNavigationState() {
      const state = {
        sidebarCollapsed: this.sidebarCollapsed,
        pinnedPages: this.pinnedPages
      }
      localStorage.setItem('navigation-state', JSON.stringify(state))
    }
  }
})
```

## 7. 导航响应式适配

### 7.1 响应式断点定义
```scss
// styles/breakpoints.scss
$breakpoints: (
  'mobile': 768px,
  'tablet': 1024px,
  'desktop': 1200px,
  'wide': 1600px
);

@mixin mobile {
  @media (max-width: #{map-get($breakpoints, 'mobile') - 1px}) {
    @content;
  }
}

@mixin tablet {
  @media (min-width: #{map-get($breakpoints, 'mobile')}) and (max-width: #{map-get($breakpoints, 'tablet') - 1px}) {
    @content;
  }
}

@mixin desktop {
  @media (min-width: #{map-get($breakpoints, 'tablet')}) {
    @content;
  }
}

@mixin wide {
  @media (min-width: #{map-get($breakpoints, 'wide')}) {
    @content;
  }
}
```

### 7.2 导航适配样式
```scss
// styles/navigation.scss
.app-navigation {
  // 桌面端导航
  @include desktop {
    .top-navigation {
      display: flex;
      height: 60px;
    }
    
    .sidebar {
      display: flex;
      width: 280px;
    }
    
    .bottom-navigation {
      display: none;
    }
  }
  
  // 平板端导航
  @include tablet {
    .top-navigation {
      display: flex;
      height: 56px;
      
      .main-navigation {
        display: none;
      }
      
      .hamburger-menu {
        display: block;
      }
    }
    
    .sidebar {
      position: fixed;
      left: -280px;
      transition: left 0.3s ease;
      z-index: 1000;
      
      &.open {
        left: 0;
      }
    }
    
    .bottom-navigation {
      display: flex;
    }
  }
  
  // 移动端导航
  @include mobile {
    .top-navigation {
      display: flex;
      height: 52px;
      padding: 0 16px;
      
      .brand-text {
        display: none;
      }
      
      .user-actions {
        .username {
          display: none;
        }
      }
    }
    
    .sidebar {
      position: fixed;
      left: -100%;
      width: 100%;
      transition: left 0.3s ease;
      z-index: 1001;
      
      &.open {
        left: 0;
      }
    }
    
    .bottom-navigation {
      display: flex;
      height: 60px;
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    .breadcrumb-nav {
      display: none;
    }
  }
}
```

## 8. 导航无障碍设计

### 8.1 键盘导航支持
```javascript
// composables/useKeyboardNavigation.js
import { onMounted, onUnmounted } from 'vue'

export function useKeyboardNavigation() {
  const handleKeydown = (event) => {
    // Alt + M: 切换主菜单
    if (event.altKey && event.key === 'm') {
      event.preventDefault()
      toggleMainMenu()
    }
    
    // Alt + S: 切换侧边栏
    if (event.altKey && event.key === 's') {
      event.preventDefault()
      toggleSidebar()
    }
    
    // Alt + 数字: 快速导航到模块
    if (event.altKey && /^[1-6]$/.test(event.key)) {
      event.preventDefault()
      navigateToModule(parseInt(event.key) - 1)
    }
    
    // Escape: 关闭菜单/对话框
    if (event.key === 'Escape') {
      closeMenus()
    }
  }
  
  onMounted(() => {
    document.addEventListener('keydown', handleKeydown)
  })
  
  onUnmounted(() => {
    document.removeEventListener('keydown', handleKeydown)
  })
  
  return {
    handleKeydown
  }
}
```

### 8.2 ARIA标签和语义化
```vue
<template>
  <nav 
    class="main-navigation" 
    role="navigation" 
    aria-label="主导航"
  >
    <ul class="nav-list" role="menubar">
      <li 
        v-for="(item, index) in menuItems" 
        :key="item.name"
        class="nav-item"
        role="none"
      >
        <router-link 
          :to="item.path"
          class="nav-link"
          role="menuitem"
          :aria-current="currentModule === item.name ? 'page' : null"
          :aria-label="`导航到${item.label}`"
          :tabindex="index === 0 ? '0' : '-1'"
        >
          <i :class="item.icon" aria-hidden="true"></i>
          <span class="nav-text">{{ item.label }}</span>
        </router-link>
      </li>
    </ul>
  </nav>
</template>
```

## 9. 导航性能优化

### 9.1 懒加载和代码分割
```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/blog',
    component: () => import('@/layouts/BlogLayout.vue'),
    children: [
      {
        path: '',
        component: () => import('@/views/blog/Dashboard.vue')
      },
      {
        path: 'articles',
        component: () => import('@/views/blog/Articles.vue')
      }
    ]
  },
  {
    path: '/english',
    component: () => import('@/layouts/EnglishLayout.vue'),
    children: [
      {
        path: '',
        component: () => import('@/views/english/Dashboard.vue')
      }
    ]
  }
  // ... 其他路由
]

export default createRouter({
  history: createWebHistory(),
  routes
})
```

### 9.2 导航预加载
```javascript
// composables/useNavigationPreload.js
import { ref, watch } from 'vue'
import { useRouter } from 'vue-router'

export function useNavigationPreload() {
  const router = useRouter()
  const preloadedRoutes = ref(new Set())
  
  const preloadRoute = async (routePath) => {
    if (preloadedRoutes.value.has(routePath)) {
      return
    }
    
    try {
      const route = router.resolve(routePath)
      if (route.matched.length > 0) {
        // 预加载路由组件
        await route.matched[0].component()
        preloadedRoutes.value.add(routePath)
      }
    } catch (error) {
      console.warn('Failed to preload route:', routePath, error)
    }
  }
  
  const preloadOnHover = (routePath) => {
    // 鼠标悬停时预加载
    setTimeout(() => preloadRoute(routePath), 100)
  }
  
  return {
    preloadRoute,
    preloadOnHover,
    preloadedRoutes
  }
}
```

这套导航设计系统提供了完整的导航解决方案，包括顶部导航、侧边导航、面包屑导航、底部导航等，同时考虑了响应式适配、无障碍访问和性能优化等方面。
