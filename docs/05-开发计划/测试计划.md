# 开发计划 - 测试计划

## 1. 目标与范围
- 目标：验证功能正确性、性能稳定性、安全合规性、跨端兼容性与可用性，支撑低成本个人化运维。
- 范围：全站模块（博客/英语/求职/待办笔记/AI助手/系统管理）、权限体系（模块/功能/数据级）、任务队列、搜索、上传下载、部署备份。

## 2. 策略与准入/准出
- 策略：左移测试（需求即验收标准）、金字塔（单测>集成>E2E）、自动化优先、数据隔离（dev/test/stage/prod）。
- 准入：接口定义（OpenAPI）完成；测试数据/环境就绪；关键路径E2E草案完成。
- 准出：覆盖率达标；0个P0；有回滚方案；性能基线达标（P95<500ms）。

## 3. 环境与数据
- 环境：
  - 本地：Docker Compose 或本机 MySQL/Redis（按需可用ES）。
  - 测试：Docker Compose（MySQL/Redis/后端/前端/Nginx/Celery/可选ES）。
  - 预发/生产：阿里云 CentOS7，2GB/40GB，Compose 部署。
- 数据：Seed（用户/角色/权限、文章、词库、简历模板、待办样例、AI会话样例）；pytest fixtures；前端Mock。

## 4. 测试类型与重点
- 功能测试：后端（视图/序列化/服务/权限/任务），前端（组件/路由守卫/指令/表单）。
- 接口测试：OpenAPI 契约校验、Schema 测试；错误码与分页协议一致性。
- E2E：登录→导航→各模块主流程；权限切换影响 UI 与 API；跨模块联动（AI 检索笔记/博客）。
- 性能：k6/Locust 压测核心接口与首页首屏（P95<500ms、FCP<2.5s）。
- 安全：CSRF/XSS/SQL 注入/上传安全/敏感信息暴露；SAST（Bandit/semgrep）、依赖扫描（pip-audit/npm audit）。
- 兼容：Chromium/Firefox/Edge；移动端 Chrome/Safari；断点<768/768-1200/>1200。
- 可用性/可访问性：ARIA、键盘导航、对比度；表单错误提示与可恢复性。

## 5. 覆盖率门槛
- 后端单测≥80%（关键服务≥90%）；前端单测≥70%（关键组件/守卫≥85%）；E2E 覆盖关键路径。

## 6. CI/CD 集成（门禁）
1) Lint/TypeCheck → 单测（前后端）→ 覆盖率门禁
2) 构建Docker镜像 → docker compose 集成测试 → E2E（无头）
3) 安全/依赖扫描 → 生产部署（带回滚）
4) 产物：LCOV/Cobertura、JUnit、性能基线、漏洞报告

## 7. 示例配置
```ini
# pytest.ini（后端）
[pytest]
DJANGO_SETTINGS_MODULE = alpha.settings
addopts = -q --reuse-db --cov=apps --cov-report=term-missing --cov-report=xml
python_files = tests.py test_*.py *_tests.py
```

```json
// package.json（前端片段）
{
  "scripts": {
    "test": "vitest run --coverage --reporter=junit",
    "test:e2e": "playwright test --reporter=line"
  }
}
```

```ts
// playwright.config.ts 片段
export default {
  use: {
    baseURL: 'http://localhost:5173',
    headless: true,
    viewport: { width: 1366, height: 768 }
  }
}
```

## 8. 缺陷管理
- 优先级：P0 阻断 / P1 高 / P2 中 / P3 低；SLA：P0 4h、P1 24h、P2 3d、P3 7d。
- 生命周期：新建→确认→修复→验证→关闭；每次发布附回归清单与已知问题。

## 9. 低配服务器要点（2GB/40GB）
- Celery worker=1、prefetch=1；限制并发；静态资源强缓存与压缩；限制上传大小；可关闭 ES 或将 heap=512m。

（随迭代补充详细用例与数据脚本，确保“AI可执行”的验收标准持续完善。）



