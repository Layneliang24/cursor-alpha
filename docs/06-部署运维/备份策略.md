# 部署运维 - 备份策略

## 1. 目标与范围
- 目标：低成本、可验证恢复；最小停机。
- 范围：MySQL；媒体文件 /opt/alpha/data/{media,static}。

## 2. 计划
- 全量：每日 03:00；保留 7 天。
- 增量：按需启用 MySQL binlog（生产可选）。

## 3. 命令
```
# MySQL 备份
TS=$(date +%F)
mkdir -p /opt/alpha/backups
docker exec -i $(docker ps -qf name=mysql) \
  mysqldump -ualpha -palpha_pass alpha | gzip > /opt/alpha/backups/alpha_${TS}.sql.gz

# 媒体
rsync -a --delete /opt/alpha/data/media/ /opt/alpha/backups/media/
```

## 4. 恢复
```
# MySQL
gunzip -c /opt/alpha/backups/alpha_YYYY-MM-DD.sql.gz | \
  docker exec -i $(docker ps -qf name=mysql) mysql -ualpha -palpha_pass alpha

# 媒体
rsync -a /opt/alpha/backups/media/ /opt/alpha/data/media/
```

## 5. 校验与演练
- 校验：文件大小/校验和；
- 演练：每周在测试环境执行一次恢复演练。
