# 系统改造原则（基于现有博客系统扩展）

## 1. 核心三原则
- 最小侵入：不修改既有核心表结构（如 `users`, `articles`），新增功能以模块（Django App / 前端模块）形式接入。
- 权限兼容：沿用现有 RBAC/权限检查，新增模块仅新增权限码（如 `<module>.access`、`<module>.<feature>`），对旧接口零感知变更。
- 渐进增强：先接入路由/菜单/最小可用功能，再按迭代补齐复杂能力与性能优化。

## 2. 前端集成规则
- 动态路由注入，不改动既有基础路由：
```javascript
// 伪代码：按权限按需注册新模块
function registerModuleRoutes(routes) {
  routes.forEach((r) => {
    if (!router.hasRoute(r.name)) router.addRoute(r)
  })
}
```
- 模块化状态隔离：新模块自带独立 Pinia store，避免全局污染。
- UI 一致性：遵循 `docs/04-界面设计/设计规范.md` 的变量与组件规范。

## 3. 后端集成规则
- 仅在 `INSTALLED_APPS` 追加新模块，保留原有顺序：
```python
# settings.py 片段
INSTALLED_APPS = [
    'apps.users', 'apps.articles',
    # 新增模块：
    'apps.english', 'apps.job', 'apps.todo', 'apps.ai',
]
```
- 统一权限命名：`<module>.access`、`<module>.<feature>`，数据级权限通过策略或装饰器控制。
- 统一审计：重要操作写入审计表，沿用既有日志/审计方案。

## 4. 数据库改造规范
- 核心表不改：新增字段以“可空/有默认值”为原则，避免阻塞迁移。
- 新模块独立迁移：
```bash
python manage.py makemigrations english
python manage.py migrate english --database=default
```
- 变更回滚：每次迁移均提供回滚脚本与影子表校验（如需要）。

## 5. 部署与运维兼容
- 不改变现有 Nginx/Compose 结构；新模块随后端镜像一并构建与发布。
- 低配优化沿用全局策略（2GB）：限制 Celery 并发、强缓存静态、必要时关闭 ES。

## 6. 验收要点（改造视角）
- 旧功能无回归缺陷；
- 新模块可按权限显隐与访问；
- 迁移过程零数据破坏；
- 部署脚本无需大改即可上线。


